
<script>
let questions = JSON.parse(localStorage.getItem("questions")) || [
  { question: "ViCi_ClownX tÃªn tháº­t lÃ  gÃ¬?", options: ["Giang", "HÆ°Æ¡ng", "An", "Linh"], correct: 0 }
];
let current = 0, score = 0, playerName = "";

// ğŸ•’ Kiá»ƒm tra xem leaderboard cÃ³ quÃ¡ 7 ngÃ y khÃ´ng
const lastClear = localStorage.getItem("leaderboardLastClear");
if (!lastClear || (Date.now() - parseInt(lastClear)) > 7 * 24 * 60 * 60 * 1000) {
  localStorage.removeItem("leaderboard");
  localStorage.setItem("leaderboardLastClear", Date.now().toString());
}

function startQuiz() {
  playerName = document.getElementById("player-name").value.trim();
  if (!playerName) return alert("Nháº­p tÃªn trÆ°á»›c Ä‘Ã£ nha!");

  if (playerName === "ViCi_ClownX") {
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("edit-section").style.display = "block";
    document.getElementById("leaderboard").style.display = "block";

    // ThÃªm nÃºt xÃ³a báº£ng xáº¿p háº¡ng cho admin
    if (!document.getElementById("clear-board-btn")) {
      const clearBtn = document.createElement("button");
      clearBtn.id = "clear-board-btn";
      clearBtn.textContent = "ğŸ§¹ XÃ³a báº£ng xáº¿p háº¡ng";
      clearBtn.onclick = clearLeaderboard;
      document.getElementById("leaderboard").appendChild(clearBtn);
    }

    alert("âœ¨ ÄÃ£ má»Ÿ cháº¿ Ä‘á»™ chá»‰nh sá»­a cho ViCi_ClownX ğŸ©·");
    renderLeaderboard();
    return;
  }

  document.getElementById("start-screen").style.display = "none";
  document.getElementById("quiz-container").style.display = "block";
  showQuestion();
}

function showQuestion() {
  const q = questions[current];
  if (!q) { endQuiz(); return; }
  document.getElementById("question").textContent = q.question;
  const opts = document.getElementById("options");
  opts.innerHTML = "";
  q.options.forEach((opt, i) => {
    const btn = document.createElement("div");
    btn.className = "option";
    btn.textContent = `${String.fromCharCode(65+i)}: ${opt}`;
    btn.onclick = () => checkAnswer(i);
    opts.appendChild(btn);
  });
}

function checkAnswer(i) {
  const q = questions[current];
  if (i === q.correct) { score++; alert("ChÃ­nh xÃ¡c ğŸ©·ğŸ®!"); }
  else { alert("Sai máº¥t rá»“i ğŸ˜…"); }
  current++;
  current < questions.length ? showQuestion() : endQuiz();
}

function endQuiz() {
  document.getElementById("quiz-container").style.display = "none";
  document.getElementById("leaderboard").style.display = "block";
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  leaderboard.push({ name: playerName, score });
  leaderboard.sort((a,b) => b.score - a.score);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  renderLeaderboard();
}

function renderLeaderboard() {
  const list = document.getElementById("leaderboard-list");
  const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
  list.innerHTML = leaderboard.length
    ? leaderboard.map(p => `<li>${p.name} - ${p.score} Ä‘iá»ƒm</li>`).join("")
    : "<li>ChÆ°a cÃ³ ai trong báº£ng xáº¿p háº¡ng ğŸ¥º</li>";
}

function resetQuiz() {
  current = 0; score = 0;
  document.getElementById("leaderboard").style.display = "none";
  document.getElementById("start-screen").style.display = "block";
  document.getElementById("player-name").value = "";
}

function clearLeaderboard() {
  if (confirm("Báº¡n cháº¯c muá»‘n xÃ³a toÃ n bá»™ báº£ng xáº¿p háº¡ng khÃ´ng?")) {
    localStorage.removeItem("leaderboard");
    localStorage.setItem("leaderboardLastClear", Date.now().toString());
    renderLeaderboard();
    alert("âœ… ÄÃ£ xÃ³a báº£ng xáº¿p háº¡ng!");
  }
}

// --- CÃ¡c chá»©c nÄƒng chá»‰nh sá»­a cÃ¢u há»i ---
function addQuestion() {
  const newQ = document.getElementById("new-question").value.trim();
  const a = document.getElementById("optA").value.trim();
  const b = document.getElementById("optB").value.trim();
  const c = document.getElementById("optC").value.trim();
  const d = document.getElementById("optD").value.trim();
  const correct = parseInt(document.getElementById("correct-answer").value);
  if (!newQ || !a || !b || !c || !d) return alert("Äiá»n Ä‘áº§y Ä‘á»§ cÃ¢u há»i vÃ  Ä‘Ã¡p Ã¡n nha ğŸ©·");

  questions.push({ question: newQ, options: [a,b,c,d], correct });
  localStorage.setItem("questions", JSON.stringify(questions));
  document.getElementById("edit-msg").textContent = "âœ… ÄÃ£ thÃªm cÃ¢u há»i má»›i!";
  document.querySelectorAll('#edit-section input').forEach(i => i.value = "");
  renderQuestionList();
}

function clearQuestions() {
  if (confirm("Báº¡n cháº¯c muá»‘n xÃ³a háº¿t cÃ¢u há»i khÃ´ng?")) {
    questions = [];
    localStorage.removeItem("questions");
    document.getElementById("edit-msg").textContent = "ğŸ—‘ ÄÃ£ xÃ³a táº¥t cáº£ cÃ¢u há»i!";
    renderQuestionList();
  }
}

function toggleQuestionList() {
  const box = document.getElementById("question-list");
  box.style.display = box.style.display === "none" ? "block" : "none";
  renderQuestionList();
}

function renderQuestionList() {
  const box = document.getElementById("question-list");
  if (!questions.length) {
    box.innerHTML = "<p>ChÆ°a cÃ³ cÃ¢u há»i nÃ o cáº£ ğŸ¥º</p>";
    return;
  }
  box.innerHTML = questions.map((q,i)=>`
    <p><b>${i+1}.</b> ${q.question}<br>
    â¤ A: ${q.options[0]} | B: ${q.options[1]} | C: ${q.options[2]} | D: ${q.options[3]}<br>
    âœ… ÄÃ¡p Ã¡n Ä‘Ãºng: ${["A","B","C","D"][q.correct]}</p>
  `).join("<hr>");
}
</script>
